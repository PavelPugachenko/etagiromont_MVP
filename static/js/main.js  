// === КАРУСЕЛЬ ===
let currentSlide = 0;
const slides = document.querySelectorAll('.carousel-item');
const totalSlides = slides.length;

function showSlide(index) {
  if (index < 0) index = totalSlides - 1;
  if (index >= totalSlides) index = 0;
  currentSlide = index;
  const offset = -currentSlide * 100;
  document.getElementById('carousel').style.transform = `translateX(${offset}%)`;
}

function nextSlide() { showSlide(currentSlide + 1); }
function prevSlide() { showSlide(currentSlide - 1); }

// Автопрокрутка каждые 5 сек (опционально)
// setInterval(nextSlide, 5000);

// === КАЛЬКУЛЯТОР ===
function calculate() {
  const area = parseFloat(document.getElementById('area').value) || 0;
  const pricePerSq = parseFloat(document.getElementById('calc-package').value) || 0;
  const total = area * pricePerSq;
  document.getElementById('total').textContent = total.toLocaleString('ru-RU');
}
calculate(); // сразу посчитать при загрузке

// === ОТПРАВКА ФОРМЫ ===
async function submitForm() {
  const name = document.getElementById('name').value;
  const phone = document.getElementById('phone').value;
  const pack = document.getElementById('package-select').value;

  if (!name || !phone || !pack) {
    alert('Заполните все поля');
    return;
  }

  const response = await fetch('/submit/', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRFToken': getCookie('csrftoken')  // важно для Django!
    },
    body: JSON.stringify({ name, phone, package: pack })
  });

  const result = await response.json();
  const resDiv = document.getElementById('form-result');
  if (result.status === 'ok') {
    resDiv.innerHTML = '<p style="color:green;">✅ Заявка отправлена! Скоро свяжемся.</p>';
    document.getElementById('name').value = '';
    document.getElementById('phone').value = '';
    document.getElementById('package-select').value = '';
  } else {
    resDiv.innerHTML = '<p style="color:red;">❌ Ошибка. Попробуйте позже.</p>';
  }
}

// Вспомогательная функция для CSRF (обязательна в Django)
function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== '') {
    const cookies = document.cookie.split(';');
    for (let i = 0; i < cookies.length; i++) {
      const cookie = cookies[i].trim();
      if (cookie.substring(0, name.length + 1) === (name + '=')) {
        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
        break;
      }
    }
  }
  return cookieValue;
}